<!DOCTYPE html>
<html>
<head>
  <title>Calculateur d'aire de gazon</title>
  <style>
    #map {
      height: 400px;
      width: 100%;
      margin-bottom: 20px;
      border-radius: 10px;
    }

    body {
      font-family: 'Roboto', sans-serif;
      font-weight: bold;
      margin: 20px;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    label {
      display: inline-block;
      width: 100px;
    }

    input[type="text"] {
      width: 200px;
      border: 1px solid #000;
      border-radius: 5px;
      padding: 5px;
    }

    button {
      background-color: #2e5ad0;
      color: #fff;
      border-radius: 30px;
      padding: 10px 20px;
      border: none;
      margin: 10px;
      cursor: pointer;
    }

    button:hover {
      background-color: #2548a8;
    }

    #drawButton {
      display: none;
    }

    #confirmButton {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Calculateur d'aire de gazon</h1>
  <div>
    <label for="address">Adresse :</label>
    <input type="text" id="address" placeholder="Entrez votre adresse">
    <button onclick="zoomToAddress()">Zoom sur l'adresse</button>
  </div>
  <div id="map"></div>
  <button onclick="startDrawing()" id="drawButton">Commencer le dessin</button>
  <div id="result"></div>
  <button onclick="confirmArea()" id="confirmButton">Confirmer l'aire</button>

  <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCV1enx5m3beWKUfx78riaWf0Fp3DDmuD4&libraries=drawing&callback=initMap" async defer></script>
  <script>
    // Variables globales
    var map;
    var drawingManager;
    var polygons = [];
    var drawButton = document.getElementById('drawButton');
    var confirmButton = document.getElementById('confirmButton');

    // Fonction d'initialisation de la carte
    function initMap() {
      map = new google.maps.Map(document.getElementById('map'), {
        center: {lat: 45.5017, lng: -73.5673}, // Montréal
        zoom: 10,
        mapTypeId: google.maps.MapTypeId.SATELLITE // Mode satellite par défaut
      });

      drawingManager = new google.maps.drawing.DrawingManager({
        drawingMode: null,
        drawingControl: false,
        map: map,
        polylineOptions: {
          strokeColor: '#73f74d', // Couleur de la ligne de dessin
          strokeWeight: 2,
          clickable: false,
          editable: true,
          zIndex: 1
        },
        markerOptions: {
          icon: {
            path: google.maps.SymbolPath.CIRCLE,
            fillColor: '#429a37', // Couleur des points de dessin
            fillOpacity: 1,
            strokeOpacity: 0,
            scale: 5
          }
        }
      });

      google.maps.event.addListener(drawingManager, 'overlaycomplete', function(event) {
        if (event.type == google.maps.drawing.OverlayType.POLYGON) {
          var polygon = event.overlay;
          polygon.setEditable(true);
          polygons.push(polygon);
          calculateArea(); // Calculer l'aire à chaque nouveau polygone
          drawButton.innerHTML = 'Recommencer le dessin'; // Mettre à jour le texte du bouton
          confirmButton.style.display = 'block'; // Afficher le bouton "Confirmer l'aire"
        }
      });

      google.maps.event.addListener(map, 'zoom_changed', function() {
        if (map.getZoom() >= 16) {
          map.setMapTypeId(google.maps.MapTypeId.SATELLITE); // Mode satellite lorsque le zoom est supérieur ou égal à 16
        } else {
          map.setMapTypeId(google.maps.MapTypeId.SATELLITE); // Mode satellite pour les autres zooms
        }
      });
    }

    // Fonction pour démarrer le dessin
    function startDrawing() {
      clearPolygons();
      drawingManager.setOptions({
        drawingMode: google.maps.drawing.OverlayType.POLYGON,
        drawingControl: false
      });
      drawButton.innerHTML = 'Recommencer le dessin'; // Mettre à jour le texte du bouton
      confirmButton.style.display = 'none'; // Masquer le bouton "Confirmer l'aire"
    }

    // Fonction de calcul de l'aire
    function calculateArea() {
      var totalArea = 0;

      for (var i = 0; i < polygons.length; i++) {
        var polygon = polygons[i];
        var path = polygon.getPath();
        var area = google.maps.geometry.spherical.computeArea(path);
        totalArea += area;
      }

      var formattedArea = (totalArea * 10.764).toFixed(2); // Conversion en pieds carrés

      document.getElementById('result').innerHTML = "L'aire totale de votre propriété est de : " + formattedArea + " ft².";
    }

    // Fonction pour zoomer sur l'adresse spécifiée
    function zoomToAddress() {
      var geocoder = new google.maps.Geocoder();
      var address = document.getElementById('address').value;
      geocoder.geocode({ 'address': address }, function(results, status) {
        if (status === google.maps.GeocoderStatus.OK) {
          var location = results[0].geometry.location;
          map.setCenter(location);
          map.setZoom(18); // Zoom plus précis pour afficher la maison
        } else {
          alert('L\'adresse spécifiée n\'a pas pu être trouvée. Veuillez réessayer.');
        }
      });
    }

    // Fonction pour supprimer tous les polygones de la carte
    function clearPolygons() {
      for (var i = 0; i < polygons.length; i++) {
        polygons[i].setMap(null);
      }
      polygons = [];
      document.getElementById('result').innerHTML = ''; // Réinitialiser le résultat
    }

    // Fonction pour confirmer l'aire et envoyer les données
    function confirmArea() {
      var totalArea = 0;

      for (var i = 0; i < polygons.length; i++) {
        var polygon = polygons[i];
        var path = polygon.getPath();
        var area = google.maps.geometry.spherical.computeArea(path);
        totalArea += area;
      }

      var formattedArea = (totalArea * 10.764).toFixed(2); // Conversion en pieds carrés

      // Envoyer les données de l'aire à un autre site web (à implémenter)
      alert("Données d'aire envoyées : " + formattedArea + " ft².");
    }
  </script>
</body>
</html>
